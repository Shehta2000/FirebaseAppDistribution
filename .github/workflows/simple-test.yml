name: Simple Flutter Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

env:
  FLUTTER_VERSION: '3.24.0'

jobs:
  test:
    name: Flutter Test & Dependencies
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: â˜• Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ğŸ¦ Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          cache: true

      - name: ğŸ“¦ Get Flutter dependencies
        run: |
          echo "ğŸ”„ Installing Flutter dependencies..."
          flutter --version
          flutter pub get
          echo "âœ… Dependencies installed successfully!"

      - name: ğŸ” Verify Flutter doctor
        run: |
          echo "ğŸ©º Running Flutter doctor..."
          flutter doctor -v
          echo "âœ… Flutter doctor completed!"

      - name: ğŸ§ª Run Flutter tests
        run: |
          echo "ğŸ§ª Running Flutter tests..."
          flutter test --no-coverage
          echo "âœ… Tests completed successfully!"

      - name: ğŸ—ï¸ Test Flutter build
        run: |
          echo "ğŸ—ï¸ Testing Flutter build..."
          flutter build apk --debug
          echo "âœ… Build test completed successfully!"

      - name: ğŸ“Š Show build info
        run: |
          echo "ğŸ“± Build Information:"
          echo "Flutter Version: $(flutter --version | head -1)"
          echo "Dart Version: $(dart --version)"
          if [ -f "build/app/outputs/flutter-apk/app-debug.apk" ]; then
            APK_SIZE=$(stat -c%s build/app/outputs/flutter-apk/app-debug.apk)
            echo "APK Size: $(($APK_SIZE / 1024 / 1024)) MB"
          fi

      - name: ğŸ‰ Success notification
        run: |
          echo "ğŸ‰ All tests passed successfully!"
          echo "âœ… Dependencies: OK"
          echo "âœ… Tests: OK" 
          echo "âœ… Build: OK"
          echo "ğŸš€ Ready for deployment!"
